<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel do Barbeiro</title>
<link rel="icon" type="image/png" href="favicon-removebg-preview.png" />
<style>
  /* ===== RESET & BASE ===== */
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
  body { background:#f4f1ee; min-height:100vh; display:flex; justify-content:center; padding:30px; color:#4e342e; }

  /* ===== CONTAINER PRINCIPAL ===== */
  #painelContainer { width:100%; max-width:1400px; }

  /* ===== HEADER ===== */
  .header {
    display:flex; justify-content:space-between; align-items:center;
    margin-bottom:25px;
  }
  .header h1 { font-size:30px; font-weight:700; color:#3e2723; }
  .header span {
    font-weight:600; font-size:15px; color:#6d4c41;
  }

  /* ===== CARDS ===== */
  .cards {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px; margin-bottom:30px;
  }
  .card {
    background:#fff; padding:28px 22px;
    border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.08);
    text-align:center; transition:0.25s;
  }
  .card:hover { transform:translateY(-4px); }
  .card h3 { font-size:16px; color:#795548; margin-bottom:12px; font-weight:600; }
  .card p { font-size:26px; font-weight:700; color:#3e2723; }

  /* ===== FILTROS ===== */
  .filters {
    display:flex; gap:14px; align-items:center;
    margin-bottom:25px; flex-wrap:wrap;
    background:#fff; padding:16px 20px; border-radius:14px;
    box-shadow:0 4px 14px rgba(0,0,0,0.06);
  }
  .filters label { font-weight:600; }
  select, input[type="date"] {
    padding:10px 12px; border-radius:10px;
    border:1px solid #c7b7ad; background:#fff;
  }
  .filters button {
    padding:10px 18px; border-radius:10px; border:none;
    background:#8d6e63; cursor:pointer;
    font-weight:600; color:#fff; transition:0.2s;
  }
  .filters button:hover { background:#6d4c41; }

  /* ===== TABELA ===== */
  table {
    width:100%; border-collapse:collapse; background:#fff;
    border-radius:14px; overflow:hidden;
    box-shadow:0 6px 20px rgba(0,0,0,0.08); margin-bottom:20px;
  }
  th, td { padding:14px; text-align:left; }
  th { background:#4e342e; color:#fff; font-size:14px; }
  tr:nth-child(even) { background:#fdfaf8; }
  tr:hover { background:#f3edea; }

  .no-appointments { margin:18px 0; font-style:italic; text-align:center; color:#6d4c41; }

  /* ===== DASHBOARD GERENTE ===== */
  #gerentePanel {
    margin-top:30px; display:none;
    background:#fff; padding:24px; border-radius:16px;
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }
  #gerentePanel h2 { margin-bottom:12px; }
  #ganhosBarbeiros {
    display:flex; gap:12px; flex-wrap:wrap;
    list-style:none; padding:0; margin-top:16px;
  }
  #ganhosBarbeiros li {
    background:#4e342e; color:#fff;
    padding:10px 16px; border-radius:10px; font-weight:600;
  }

  /* ===== BOT√ïES TABELA ===== */
  .editBtn, .delBtn {
    padding:7px 12px; margin:0 3px; border:none;
    border-radius:6px; font-size:13px; cursor:pointer; color:#fff;
    transition:0.2s;
  }
  .editBtn { background:#ffb74d; }
  .editBtn:hover { background:#ffa726; }
  .delBtn { background:#e57373; }
  .delBtn:hover { background:#ef5350; }

  /* ===== MODAL ===== */
  .modal {
    position: fixed; top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.5);
    display:flex; justify-content:center; align-items:center;
    visibility:hidden; opacity:0; transition:0.3s; z-index:100;
  }
  .modal.active { visibility:visible; opacity:1; }
  .modal-content {
    background:#fff; padding:24px; border-radius:14px;
    width:360px; max-width:90%; text-align:center;
    box-shadow:0 6px 20px rgba(0,0,0,0.25);
  }
  .modal-content h3 { margin-bottom:18px; }
  .modal-content input, .modal-content select {
    width:100%; padding:10px 12px; margin:8px 0;
    border-radius:8px; border:1px solid #c7b7ad;
  }
  .modal-content button {
    padding:10px 16px; border:none; border-radius:8px;
    margin:10px 6px; cursor:pointer; font-weight:600;
  }
  .modal-content .saveBtn { background:#4caf50; color:#fff; }
  .modal-content .cancelBtn { background:#e57373; color:#fff; }
</style>
</head>
<body>

<div id="painelContainer">

  <!-- HEADER -->
  <div class="header">
    <h1>Painel do Barbeiro</h1>
    <span>üíà Soul Fade</span>
  </div>

  <!-- Cards -->
  <div class="cards">
    <div class="card"><h3>Ganhos</h3><p id="cardGanhos">R$ 0,00</p></div>
    <div class="card"><h3>Clientes</h3><p id="cardClientes">0</p></div>
    <div class="card"><h3>Agendamentos</h3><p id="cardAgendamentos">0</p></div>
    <div class="card"><h3>Avalia√ß√£o</h3><p id="cardAvaliacao">‚≠ê 8,5</p></div>
  </div>

  <!-- Filtros -->
<div class="filters">
  <label for="barbeiroSelect">Barbeiro:</label>
  <select id="barbeiroSelect">
    <option value="">-- Todos --</option>
    <option value="Lucas Dias">Lucas Dias</option>
    <option value="Isaias Barreto">Isaias Barreto</option>
    <option value="Isaias Santana">Isaias Santana</option>
  </select>

  <label for="dateSelect">Data:</label>
  <input type="date" id="dateSelect" />

  <button id="clearFilters">Limpar filtros</button>
  <button id="novoAgendamentoBtn">‚ûï Novo Agendamento</button>
</div>

  <!-- Tabela -->
  <table id="agendaTable">
    <thead>
      <tr><th>Dia</th><th>Hor√°rio</th><th>Cliente</th><th>Servi√ßo</th><th>Barbeiro</th><th>A√ß√µes</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="noAppointments" class="no-appointments">Selecione um barbeiro ou uma data para ver os agendamentos.</div>

  <!-- Painel Gerente -->
  <div id="gerentePanel">
  <h2>üìà Dashboard do Gerente</h2>
  <p>Aqui voc√™ ver√° vendas e desempenho dos barbeiros:</p>
  <ul id="ganhosBarbeiros"></ul>
</div>
</div>

<!-- Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3>Editar Agendamento</h3>
    <label>Data:</label>
    <input type="date" id="editDia" />
    <label>Hor√°rio:</label>
    <input type="time" id="editHorario" />
    <label>Barbeiro:</label>
    <select id="editBarbeiro">
      <option value="Lucas Dias">Lucas Dias</option>
      <option value="Isaias Barreto">Isaias Barreto</option>
      <option value="Isaias Santana">Isaias Santana</option>
    </select>
    <div>
      <button class="saveBtn">Salvar</button>
      <button class="cancelBtn">Cancelar</button>
    </div>
  </div>
</div>

<div id="novoModal" class="modal">
  <div class="modal-content">
    <h3>Novo Agendamento</h3>

    <!-- Escolha primeiro o barbeiro -->
    <label>Barbeiro:</label>
    <select id="novoBarbeiro">
      <option value="Lucas Dias">Lucas Dias</option>
      <option value="Isaias Barreto">Isaias Barreto</option>
      <option value="Isaias Santana">Isaias Santana</option>
    </select>

    <!-- Depois a data -->
    <label>Data:</label>
    <input type="date" id="novoDia" />

    <!-- Hor√°rios fixos de 1h (09h at√© 18h) -->
    <label>Hor√°rio:</label>
    <select id="novoHorario">
      <option value="09:00">09:00</option>
      <option value="10:00">10:00</option>
      <option value="11:00">11:00</option>
      <option value="12:00">12:00</option>
      <option value="13:00">13:00</option>
      <option value="14:00">14:00</option>
      <option value="15:00">15:00</option>
      <option value="16:00">16:00</option>
      <option value="17:00">17:00</option>
      <option value="18:00">18:00</option>
    </select>

    <label>Cliente:</label>
    <input type="text" id="novoCliente" placeholder="Nome do cliente" />

    <label>Servi√ßo:</label>
    <input type="text" id="novoServico" placeholder="Ex: Corte Tradicional" />

    <div>
      <button class="saveBtn" id="salvarNovo">Salvar</button>
      <button class="cancelBtn" id="cancelarNovo">Cancelar</button>
    </div>
  </div>
</div>

<script>
const API_URL = "https://soulfade.onrender.com/api"; 

// Elementos
const barbeiroSelect = document.getElementById("barbeiroSelect");
const dateSelect = document.getElementById("dateSelect");
const tableBody = document.querySelector("#agendaTable tbody");
const noAppointments = document.getElementById("noAppointments");
const gerentePanel = document.getElementById("gerentePanel");
const ganhosBarbeirosList = document.getElementById("ganhosBarbeiros");
const cardGanhos = document.getElementById("cardGanhos");
const cardClientes = document.getElementById("cardClientes");
const cardAgendamentos = document.getElementById("cardAgendamentos");

// Modal e inputs
const editModal = document.getElementById("editModal");
const editDia = document.getElementById("editDia");
const editHorario = document.getElementById("editHorario");
const editBarbeiro = document.getElementById("editBarbeiro");
let editId = null;

// Fun√ß√£o principal para carregar agendamentos
async function carregarAgendamentos(barbeiro, dia) {
  try {
    let url = `${API_URL}/agendamentos`;
    const params = new URLSearchParams();
    if (barbeiro) params.set("barbeiro", barbeiro);
    if (dia) params.set("dia", dia);
    if (params.toString()) url += "?" + params.toString();

    const res = await fetch(url);
    const agendamentos = await res.json();
    tableBody.innerHTML = "";

    if (!agendamentos.length) {
      noAppointments.style.display = "block";
      return;
    }
    noAppointments.style.display = "none";

    agendamentos.forEach(a => {
      const diaFmt = a.dia.split("T")[0].split("-").reverse().join("/");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${diaFmt}</td>
        <td>${a.horario}</td>
        <td>${a.nome}</td>
        <td>${a.servico}</td>
        <td>${a.barbeiro}</td>
        <td>
          <button class="editBtn" data-id="${a.id}">Editar</button>
          <button class="delBtn" data-id="${a.id}">Excluir</button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
    ativarBotoes();
  } catch(err) {
    console.error(err);
    tableBody.innerHTML = "";
    noAppointments.style.display = "block";
  }
}

// Ativa bot√µes editar e excluir
function ativarBotoes() {
  document.querySelectorAll(".delBtn").forEach(btn => {
    btn.onclick = async () => {
      if (!confirm("Deseja realmente excluir este agendamento?")) return;
      const id = btn.dataset.id;
      try { await fetch(`${API_URL}/agendamentos/${id}`, { method: "DELETE" }); atualizarTudo(); }
      catch(e){ console.error(e); }
    };
  });

  document.querySelectorAll(".editBtn").forEach(btn => {
    btn.onclick = () => {
      editId = btn.dataset.id;
      const tr = btn.closest("tr");
      editDia.value = tr.children[0].textContent.split('/').reverse().join('-');
      editHorario.value = tr.children[1].textContent;
      editBarbeiro.value = tr.children[4].textContent;
      editModal.classList.add("active");
    };
  });
}

// Salvar edi√ß√£o
editModal.querySelector(".saveBtn").onclick = async () => {
  if(!editDia.value || !editHorario.value || !editBarbeiro.value) return alert("Preencha todos os campos!");
  try{
    await fetch(`${API_URL}/agendamentos/${editId}`, {
      method:"PUT",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        dia: editDia.value,
        horario: editHorario.value,
        barbeiro: editBarbeiro.value
      })
    });
    editModal.classList.remove("active");
    atualizarTudo();
  }catch(e){ console.error(e); }
};

// Cancelar edi√ß√£o
editModal.querySelector(".cancelBtn").onclick = () => editModal.classList.remove("active");

// Carregar ganhos do gerente
// Carregar ganhos do gerente (ajustado s√≥ para comiss√£o)
async function carregarGanhosGerente() {
  try {
    const res = await fetch(`${API_URL}/ganhos`);
    const dados = await res.json();
    ganhosBarbeirosList.innerHTML = "";

    // mostra s√≥ a comiss√£o de cada barbeiro
    Object.entries(dados.comissoes).forEach(([b, v]) => {
      const li = document.createElement("li");
      li.textContent = `${b}: R$ ${Number(v).toFixed(2)}`;
      ganhosBarbeirosList.appendChild(li);
    });
    gerentePanel.style.display = "block";
  } catch (err) { console.error(err); }
}


// Atualizar cards
async function atualizarCards(barbeiro, dia) {
  try {
    let url = `${API_URL}/agendamentos`;
    const params = new URLSearchParams();
    if (barbeiro) params.set("barbeiro", barbeiro);
    if (dia) params.set("dia", dia);
    if (params.toString()) url += "?" + params.toString();

    const res = await fetch(url);
    const agend = await res.json();

    const clientesUnicos = new Set(agend.map(a => (a.nome || "").trim())).size;
    const totalAgend = agend.length;

    const rg = await fetch(`${API_URL}/ganhos`);
    const dados = await rg.json();

    let ganhosMostrar = barbeiro
      ? Number(dados.ganhos[barbeiro] || 0)
      : Object.values(dados.ganhos).reduce((s, v) => s + Number(v || 0), 0);

    cardGanhos.textContent = `R$ ${ganhosMostrar.toFixed(2)}`;
    cardClientes.textContent = clientesUnicos;
    cardAgendamentos.textContent = totalAgend;
  } catch (e) { console.error(e); }
}

// Atualiza tudo
function atualizarTudo(){
  carregarAgendamentos(barbeiroSelect.value,dateSelect.value);
  atualizarCards(barbeiroSelect.value,dateSelect.value);
  carregarGanhosGerente();
}

// Eventos filtros
barbeiroSelect.onchange = atualizarTudo;
dateSelect.onchange = atualizarTudo;
document.getElementById("clearFilters").onclick = () => {
  barbeiroSelect.value = "";
  dateSelect.value = "";
  atualizarTudo();
};



// Elementos do novo agendamento
const novoModal = document.getElementById("novoModal");
const novoBtn = document.getElementById("novoAgendamentoBtn");
const novoDia = document.getElementById("novoDia");
const novoHorario = document.getElementById("novoHorario");
const novoCliente = document.getElementById("novoCliente");
const novoServico = document.getElementById("novoServico");
const novoBarbeiro = document.getElementById("novoBarbeiro");

// Abrir modal de novo agendamento
novoBtn.onclick = () => {
  novoDia.value = "";
  novoHorario.value = "";
  novoCliente.value = "";
  novoServico.value = "";
  novoBarbeiro.value = "";
  novoModal.classList.add("active");
};

// Cancelar novo
document.getElementById("cancelarNovo").onclick = () => {
  novoModal.classList.remove("active");
};

// Salvar novo agendamento
document.getElementById("salvarNovo").onclick = async () => {
  if(!novoDia.value || !novoHorario.value || !novoCliente.value || !novoServico.value || !novoBarbeiro.value){
    return alert("Preencha todos os campos!");
  }

  try{
    await fetch(`${API_URL}/agendamentos`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        dia: novoDia.value,
        horario: novoHorario.value,
        nome: novoCliente.value,
        servico: novoServico.value,
        barbeiro: novoBarbeiro.value
      })
    });
    novoModal.classList.remove("active");
    atualizarTudo();
  }catch(e){ console.error(e); }
};


// Inicializa
atualizarTudo();
</script>
</body>
</html>
