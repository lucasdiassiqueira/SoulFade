<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel do Barbeiro</title>
<link rel="icon" type="image/png" href="favicon-removebg-preview.png" />
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
  body { background:#f4f1ee; min-height:100vh; display:flex; justify-content:center; align-items:center; padding:30px; color:#4e342e; }

  #painelContainer { width:100%; max-width:1400px; display:none; }

  .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; }
  .header h1 { font-size:30px; font-weight:700; color:#3e2723; }
  .header span { font-weight:600; font-size:15px; color:#6d4c41; }

  .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; margin-bottom:30px; }
  .card { background:#fff; padding:28px 22px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.08); text-align:center; transition:0.25s; }
  .card:hover { transform:translateY(-4px); }
  .card h3 { font-size:16px; color:#795548; margin-bottom:12px; font-weight:600; }
  .card p { font-size:26px; font-weight:700; color:#3e2723; }

  .filters { display:flex; gap:14px; align-items:center; margin-bottom:25px; flex-wrap:wrap; background:#fff; padding:16px 20px; border-radius:14px; box-shadow:0 4px 14px rgba(0,0,0,0.06); }
  .filters label { font-weight:600; }
  select, input[type="date"] { padding:10px 12px; border-radius:10px; border:1px solid #c7b7ad; background:#fff; }
  .filters button { padding:10px 18px; border-radius:10px; border:none; background:#8d6e63; cursor:pointer; font-weight:600; color:#fff; transition:0.2s; }
  .filters button:hover { background:#6d4c41; }

  table { width:100%; border-collapse:collapse; background:#fff; border-radius:14px; overflow:hidden; box-shadow:0 6px 20px rgba(0,0,0,0.08); margin-bottom:20px; }
  th, td { padding:14px; text-align:left; }
  th { background:#4e342e; color:#fff; font-size:14px; }
  tr:nth-child(even) { background:#fdfaf8; }
  tr:hover { background:#f3edea; }

  .no-appointments { margin:18px 0; font-style:italic; text-align:center; color:#6d4c41; }

  #gerentePanel { margin-top:30px; display:none; background:#fff; padding:24px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
  #gerentePanel h2 { margin-bottom:12px; }
  #ganhosBarbeiros { display:flex; gap:12px; flex-wrap:wrap; list-style:none; padding:0; margin-top:16px; }
  #ganhosBarbeiros li { background:#4e342e; color:#fff; padding:10px 16px; border-radius:10px; font-weight:600; }

  .editBtn, .delBtn { padding:7px 12px; margin:0 3px; border:none; border-radius:6px; font-size:13px; cursor:pointer; color:#fff; transition:0.2s; }
  .editBtn { background:#ffb74d; }
  .editBtn:hover { background:#ffa726; }
  .delBtn { background:#e57373; }
  .delBtn:hover { background:#ef5350; }

  .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; visibility:hidden; opacity:0; transition:0.3s; z-index:100; }
  .modal.active { visibility:visible; opacity:1; }
  .modal-content { background:#fff; padding:24px; border-radius:14px; width:360px; max-width:90%; text-align:center; box-shadow:0 6px 20px rgba(0,0,0,0.25); }
  .modal-content h3 { margin-bottom:18px; }
  .modal-content input, .modal-content select { width:100%; padding:10px 12px; margin:8px 0; border-radius:8px; border:1px solid #c7b7ad; }
  .modal-content button { padding:10px 16px; border:none; border-radius:8px; margin:10px 6px; cursor:pointer; font-weight:600; }
  .modal-content .saveBtn { background:#4caf50; color:#fff; }
  .modal-content .cancelBtn { background:#e57373; color:#fff; }

  /* LOGIN */
  #loginContainer { background:#fff; padding:36px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.25); text-align:center; }
  #loginContainer h2 { margin-bottom:20px; }
  #loginContainer input { width:80%; padding:10px 12px; margin:8px 0; border-radius:8px; border:1px solid #c7b7ad; }
  #loginContainer button { padding:10px 16px; border:none; border-radius:8px; background:#4caf50; color:#fff; cursor:pointer; font-weight:600; margin-top:10px; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginContainer">
  <h2>Login do Painel</h2>
  <input type="text" id="username" placeholder="Usu√°rio" />
  <input type="password" id="password" placeholder="Senha" />
  <br>
  <button id="loginBtn">Entrar</button>
</div>

<!-- PAINEL -->
<div id="painelContainer">

  <div class="header">
    <h1>Painel do Barbeiro</h1>
    <span>üíà Soul Fade</span>
  </div>

  <div class="cards">
    <div class="card"><h3>Ganhos</h3><p id="cardGanhos">R$ 0,00</p></div>
    <div class="card"><h3>Clientes</h3><p id="cardClientes">0</p></div>
    <div class="card"><h3>Agendamentos</h3><p id="cardAgendamentos">0</p></div>
    <div class="card"><h3>Avalia√ß√£o</h3><p id="cardAvaliacao">‚≠ê 8,5</p></div>
  </div>

  <div class="filters">
    <label for="barbeiroSelect">Barbeiro:</label>
    <select id="barbeiroSelect">
      <option value="">-- Todos --</option>
      <option value="Lucas Dias">Lucas Dias</option>
      <option value="Isaias Barreto">Isaias Barreto</option>
      <option value="Isaias Santana">Isaias Santana</option>
    </select>

    <label for="dateSelect">Data:</label>
    <input type="date" id="dateSelect" />

    <button id="clearFilters">Limpar filtros</button>
  </div>

  <table id="agendaTable">
    <thead>
      <tr><th>Dia</th><th>Hor√°rio</th><th>Cliente</th><th>Servi√ßo</th><th>Barbeiro</th><th>A√ß√µes</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="noAppointments" class="no-appointments">Selecione um barbeiro ou uma data para ver os agendamentos.</div>

  <div id="gerentePanel">
    <h2>üìà Dashboard do Gerente</h2>
    <p>Aqui voc√™ ver√° vendas e desempenho dos barbeiros:</p>
    <ul id="ganhosBarbeiros"></ul>
  </div>
</div>

<script>
const API_URL = "https://soulfade.onrender.com/api"; 

// LOGIN SIMPLES
// LOGIN SIMPLES
const loginBtn = document.getElementById("loginBtn");
const loginContainer = document.getElementById("loginContainer");
const painelContainer = document.getElementById("painelContainer");

const users = {
  gerente: { password: "1234", role: "gerente" },
  lucas: { password: "1111", role: "barbeiro" },
  isaias: { password: "2222", role: "barbeiro" }
};

let usuarioLogado = null; // Vari√°vel global

loginBtn.onclick = () => {
  const username = document.getElementById("username").value.toLowerCase();
  const password = document.getElementById("password").value;
  if(users[username] && users[username].password === password){
    usuarioLogado = users[username]; // salva o usu√°rio logado
    loginContainer.style.display = "none";
    painelContainer.style.display = "block";

    if(usuarioLogado.role === "barbeiro"){
      document.querySelector(".cards").style.display = "none";
      gerentePanel.style.display = "none";
    }

    atualizarTudo(); // atualiza tudo conforme usu√°rio logado
  } else {
    alert("Usu√°rio ou senha incorretos!");
  }
};

// FUN√á√ïES ORIGINAIS
async function carregarAgendamentos(barbeiro, dia){
  try{
    let url = `${API_URL}/agendamentos`;
    const params = new URLSearchParams();
    if(barbeiro) params.set("barbeiro", barbeiro);
    if(dia) params.set("dia", dia);
    if(params.toString()) url += "?" + params.toString();
    const res = await fetch(url);
    const agendamentos = await res.json();
    tableBody.innerHTML = "";
    if(!agendamentos.length){
      noAppointments.style.display="block"; return;
    }
    noAppointments.style.display="none";
    agendamentos.forEach(a=>{
      const diaFmt = a.dia.split("T")[0].split("-").reverse().join("/");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${diaFmt}</td>
        <td>${a.horario}</td>
        <td>${a.nome}</td>
        <td>${a.servico}</td>
        <td>${a.barbeiro}</td>
        <td>
          <button class="editBtn" data-id="${a.id}">Editar</button>
          <button class="delBtn" data-id="${a.id}">Excluir</button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
    ativarBotoes();
  }catch(err){ console.error(err); tableBody.innerHTML=""; noAppointments.style.display="block"; }
}

function ativarBotoes(){
  document.querySelectorAll(".delBtn").forEach(btn=>{
    btn.onclick=async ()=>{
      if(!confirm("Deseja realmente excluir este agendamento?")) return;
      const id = btn.dataset.id;
      try{ await fetch(`${API_URL}/agendamentos/${id}`,{method:"DELETE"}); atualizarTudo(); }catch(e){console.error(e);}
    };
  });
  document.querySelectorAll(".editBtn").forEach(btn=>{
    btn.onclick=()=>{ alert("Editar funcionalidade aqui"); };
  });
}

// FUN√á√ÉO DE GANHOS DO GERENTE (s√≥ para gerente)
async function carregarGanhosGerente(){
  if(!usuarioLogado || usuarioLogado.role !== "gerente") return; // bloqueia para barbeiros
  try{
    const res = await fetch(`${API_URL}/ganhos`);
    const ganhos = await res.json();
    ganhosBarbeirosList.innerHTML="";
    Object.entries(ganhos).forEach(([b,v])=>{
      if(b!=="total"){
        const li = document.createElement("li");
        li.textContent = `${b}: R$ ${Number(v).toFixed(2)}`;
        ganhosBarbeirosList.appendChild(li);
      }
    });
    gerentePanel.style.display="block";
  }catch(err){console.error(err);}
}

async function atualizarCards(barbeiro,dia){
  try{
    let url = `${API_URL}/agendamentos`;
    const params = new URLSearchParams();
    if(barbeiro) params.set("barbeiro",barbeiro);
    if(dia) params.set("dia",dia);
    if(params.toString()) url += "?" + params.toString();
    const res = await fetch(url);
    const agend = await res.json();
    const clientesUnicos = new Set(agend.map(a=>(a.nome||"").trim())).size;
    const totalAgend = agend.length;
    const rg = await fetch(`${API_URL}/ganhos`);
    const ganhosObj = await rg.json();
    let ganhosMostrar = barbeiro ? Number(ganhosObj[barbeiro]||0) 
                                 : Object.entries(ganhosObj).filter(([k])=>k!=="total").reduce((s,[,v])=>s+Number(v||0),0);
    cardGanhos.textContent = `R$ ${ganhosMostrar.toFixed(2)}`;
    cardClientes.textContent = clientesUnicos;
    cardAgendamentos.textContent = totalAgend;
  }catch(e){console.error(e);}
}

function atualizarTudo(){
  carregarAgendamentos(barbeiroSelect.value,dateSelect.value);
  atualizarCards(barbeiroSelect.value,dateSelect.value);
  carregarGanhosGerente(); // s√≥ ser√° chamado se for gerente
}

// Eventos filtros
barbeiroSelect.onchange = atualizarTudo;
dateSelect.onchange = atualizarTudo;
document.getElementById("clearFilters").onclick = ()=>{
  barbeiroSelect.value=""; dateSelect.value=""; atualizarTudo();
};
</script>
</body>
</html>
