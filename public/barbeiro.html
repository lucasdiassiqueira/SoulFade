<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel do Barbeiro</title>
<link rel="icon" type="image/png" href="favicon-removebg-preview.png" />
<style>
  /* ===== RESET & BASE ===== */
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
  body { background:#f4f1ee; min-height:100vh; display:flex; align-items:flex-start; padding:30px; color:#4e342e; }

  /* ===== LAYOUT PRINCIPAL ===== */
  #painelContainer { width:100%; max-width:1400px; margin:0 auto; display:flex; gap:20px; }

  /* ===== SIDEBAR ===== */
  .sidebar {
    width:240px; background:#4e342e; color:#fff;
    border-radius:16px; padding:22px; flex-shrink:0;
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
    display:flex; flex-direction:column; align-items:center;
  }
  .sidebar h2 { margin-bottom:28px; text-align:center; font-size:22px; }
  .sidebar a {
    display:block; width:100%; text-align:left;
    color:#f8e9e4; text-decoration:none;
    padding:12px 14px; border-radius:10px; margin:6px 0;
    transition:0.2s;
  }
  .sidebar a:hover { background:#6d4c41; }

  /* ===== MAIN ===== */
  .main { flex:1; }
  .main h1 { margin-bottom:18px; font-size:28px; font-weight:700; }

  /* ===== CARDS ===== */
  .cards {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:18px; margin-bottom:26px;
  }
  .card {
    background:#fff; padding:22px;
    border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,0.07);
    text-align:center; transition:0.2s;
  }
  .card:hover { transform:translateY(-3px); }
  .card h3 { font-size:16px; color:#7b5e57; margin-bottom:10px; font-weight:600; }
  .card p { font-size:24px; font-weight:700; color:#4e342e; }

  /* ===== FILTROS ===== */
  .filters {
    display:flex; gap:14px; align-items:center;
    margin-bottom:20px; flex-wrap:wrap;
    background:#fff; padding:14px 18px; border-radius:12px;
    box-shadow:0 4px 14px rgba(0,0,0,0.05);
  }
  .filters label { font-weight:600; }
  select, input[type="date"] {
    padding:10px 12px; border-radius:10px;
    border:1px solid #c7b7ad; background:#fff;
  }
  .filters button {
    padding:10px 16px; border-radius:10px; border:none;
    background:#a1887f; cursor:pointer;
    font-weight:600; color:#fff; transition:0.2s;
  }
  .filters button:hover { background:#8d6e63; }

  /* ===== TABELA ===== */
  table {
    width:100%; border-collapse:collapse; background:#fff;
    border-radius:14px; overflow:hidden;
    box-shadow:0 6px 20px rgba(0,0,0,0.07); margin-bottom:20px;
  }
  th, td { padding:14px; text-align:left; }
  th { background:#4e342e; color:#fff; font-size:14px; }
  tr:nth-child(even) { background:#fdfaf8; }
  tr:hover { background:#f3edea; }

  .no-appointments { margin:16px 0; font-style:italic; color:#6d4c41; }

  /* ===== DASHBOARD GERENTE ===== */
  #gerentePanel {
    margin-top:20px; display:none;
    background:#fff; padding:20px; border-radius:14px;
    box-shadow:0 6px 20px rgba(0,0,0,0.07);
  }
  #gerentePanel h2 { margin-bottom:10px; }
  #ganhosBarbeiros {
    display:flex; gap:10px; flex-wrap:wrap;
    list-style:none; padding:0; margin-top:12px;
  }
  #ganhosBarbeiros li {
    background:#4e342e; color:#fff;
    padding:10px 14px; border-radius:8px; font-weight:600;
  }

  /* ===== BOT√ïES TABELA ===== */
  .editBtn, .delBtn {
    padding:6px 10px; margin:0 2px; border:none;
    border-radius:6px; font-size:13px; cursor:pointer; color:#fff;
    transition:0.2s;
  }
  .editBtn { background:#ffb74d; }
  .editBtn:hover { background:#ffa726; }
  .delBtn { background:#e57373; }
  .delBtn:hover { background:#ef5350; }

  /* ===== MODAL ===== */
  .modal {
    position: fixed; top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.5);
    display:flex; justify-content:center; align-items:center;
    visibility:hidden; opacity:0; transition:0.3s; z-index:100;
  }
  .modal.active { visibility:visible; opacity:1; }
  .modal-content {
    background:#fff; padding:20px; border-radius:12px;
    width:340px; max-width:90%; text-align:center;
    box-shadow:0 6px 20px rgba(0,0,0,0.2);
  }
  .modal-content h3 { margin-bottom:16px; }
  .modal-content input, .modal-content select {
    width:100%; padding:8px 10px; margin:6px 0;
    border-radius:8px; border:1px solid #c7b7ad;
  }
  .modal-content button {
    padding:8px 14px; border:none; border-radius:8px;
    margin:8px 4px; cursor:pointer; font-weight:600;
  }
  .modal-content .saveBtn { background:#4caf50; color:#fff; }
  .modal-content .cancelBtn { background:#e57373; color:#fff; }
</style>
</head>
<body>

<div id="painelContainer">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>üíà Barber</h2>
    <a href="#">üìÖ Agenda</a>
    <a href="#">üìä Relat√≥rios</a>
    <a href="#">‚úâÔ∏è Mensagens</a>
    <a href="#">‚öôÔ∏è Configura√ß√µes</a>
  </aside>

  <!-- Main -->
  <div class="main">
    <h1>Painel do Barbeiro</h1>

    <!-- Cards -->
    <div class="cards">
      <div class="card"><h3>Ganhos</h3><p id="cardGanhos">R$ 0,00</p></div>
      <div class="card"><h3>Clientes</h3><p id="cardClientes">0</p></div>
      <div class="card"><h3>Agendamentos</h3><p id="cardAgendamentos">0</p></div>
      <div class="card"><h3>Avalia√ß√£o</h3><p id="cardAvaliacao">‚≠ê 8,5</p></div>
    </div>

    <!-- Filtros -->
    <div class="filters">
      <label for="barbeiroSelect">Barbeiro:</label>
      <select id="barbeiroSelect">
        <option value="">-- Todos --</option>
        <option value="Lucas Dias">Lucas Dias</option>
        <option value="Isaias Barreto">Isaias Barreto</option>
        <option value="Isaias Santana">Isaias Santana</option>
      </select>

      <label for="dateSelect">Data:</label>
      <input type="date" id="dateSelect" />

      <button id="clearFilters">Limpar filtros</button>
    </div>

    <!-- Tabela -->
    <table id="agendaTable">
      <thead>
        <tr><th>Dia</th><th>Hor√°rio</th><th>Cliente</th><th>Servi√ßo</th><th>Barbeiro</th><th>A√ß√µes</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="noAppointments" class="no-appointments">Selecione um barbeiro ou uma data para ver os agendamentos.</div>

    <!-- Painel Gerente -->
    <div id="gerentePanel">
      <h2>üìà Dashboard do Gerente</h2>
      <p>Aqui voc√™ ver√° vendas e desempenho dos barbeiros:</p>
      <ul id="ganhosBarbeiros"></ul>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3>Editar Agendamento</h3>
    <label>Data:</label>
    <input type="date" id="editDia" />
    <label>Hor√°rio:</label>
    <input type="time" id="editHorario" />
    <label>Barbeiro:</label>
    <select id="editBarbeiro">
      <option value="Lucas Dias">Lucas Dias</option>
      <option value="Isaias Barreto">Isaias Barreto</option>
      <option value="Isaias Santana">Isaias Santana</option>
    </select>
    <div>
      <button class="saveBtn">Salvar</button>
      <button class="cancelBtn">Cancelar</button>
    </div>
  </div>
</div>

<script>
const API_URL = "https://soulfade.onrender.com/api"; 

const barbeiroSelect = document.getElementById("barbeiroSelect");
const dateSelect = document.getElementById("dateSelect");
const tableBody = document.querySelector("#agendaTable tbody");
const noAppointments = document.getElementById("noAppointments");
const gerentePanel = document.getElementById("gerentePanel");
const ganhosBarbeirosList = document.getElementById("ganhosBarbeiros");
const cardGanhos = document.getElementById("cardGanhos");
const cardClientes = document.getElementById("cardClientes");
const cardAgendamentos = document.getElementById("cardAgendamentos");

// Modal e inputs
const editModal = document.getElementById("editModal");
const editDia = document.getElementById("editDia");
const editHorario = document.getElementById("editHorario");
const editBarbeiro = document.getElementById("editBarbeiro");
let editId = null;

// === FUN√á√ïES PRINCIPAIS ===
async function carregarAgendamentos(barbeiro, dia) {
  try {
    let url = `${API_URL}/agendamentos`;
    const params = new URLSearchParams();
    if (barbeiro) params.set("barbeiro", barbeiro);
    if (dia) params.set("dia", dia);
    if (params.toString()) url += "?" + params.toString();

    const res = await fetch(url);
    const agendamentos = await res.json();
    tableBody.innerHTML = "";

    if (!agendamentos.length) {
      noAppointments.textContent = "Nenhum agendamento encontrado.";
      noAppointments.style.display = "block";
      return;
    }
    noAppointments.style.display = "none";

    agendamentos.forEach(a => {
  const diaFmt = a.dia.split("T")[0].split("-").reverse().join("/"); 
  
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${diaFmt}</td>
    <td>${a.horario}</td>
    <td>${a.nome}</td>
    <td>${a.servico}</td>
    <td>${a.barbeiro}</td>
    <td>
      <button class="editBtn" data-id="${a.id}">Editar</button>
      <button class="delBtn" data-id="${a.id}">Excluir</button>
    </td>
  `;
  tableBody.appendChild(tr);
});


    ativarBotoes();
  } catch(err) {
    console.error(err);
    tableBody.innerHTML = "";
    noAppointments.textContent = "Erro ao carregar agendamentos.";
    noAppointments.style.display = "block";
  }
}

function ativarBotoes() {
  // Excluir
  document.querySelectorAll(".delBtn").forEach(btn => {
    btn.addEventListener("click", async () => {
      const id = btn.dataset.id;
      if (!confirm("Deseja realmente excluir este agendamento?")) return;
      try {
        await fetch(`${API_URL}/agendamentos/${id}`, { method: "DELETE" });
        carregarAgendamentos(barbeiroSelect.value, dateSelect.value);
        atualizarCards(barbeiroSelect.value, dateSelect.value);
        carregarGanhosGerente();
      } catch(e){ console.error(e); }
    });
  });

  // Editar
  document.querySelectorAll(".editBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      editId = btn.dataset.id;
      const tr = btn.closest("tr");
      editDia.value = new Date(tr.children[0].textContent.split('/').reverse().join('-')).toISOString().split('T')[0];
      editHorario.value = tr.children[1].textContent;
      editBarbeiro.value = tr.children[4].textContent;
      editModal.classList.add("active");
    });
  });
}

// Salvar edi√ß√£o
editModal.querySelector(".saveBtn").addEventListener("click", async () => {
  if(!editDia.value || !editHorario.value || !editBarbeiro.value) return alert("Preencha todos os campos!");
  try{
    await fetch(`${API_URL}/agendamentos/${editId}`, {
      method:"PUT",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        dia: editDia.value,
        horario: editHorario.value,
        barbeiro: editBarbeiro.value
      })
    });
    editModal.classList.remove("active");
    carregarAgendamentos(barbeiroSelect.value, dateSelect.value);
    atualizarCards(barbeiroSelect.value, dateSelect.value);
    carregarGanhosGerente();
  }catch(e){ console.error(e); }
});

// Cancelar edi√ß√£o
editModal.querySelector(".cancelBtn").addEventListener("click", () => {
  editModal.classList.remove("active");
});

async function carregarGanhosGerente() {
  try {
    const res = await fetch(`${API_URL}/ganhos`);
    const ganhos = await res.json();
    ganhosBarbeirosList.innerHTML = "";
    for(let b in ganhos){
      const li = document.createElement("li");
      li.textContent = `${b}: R$ ${Number(ganhos[b]).toFixed(2)}`;
      ganhosBarbeirosList.appendChild(li);
    }
    gerentePanel.style.display = "block";
  } catch(err){ console.error(err); }
}

async function atualizarCards(barbeiro, dia){
  try{
    let url = `${API_URL}/agendamentos`;
    const params = new URLSearchParams();
    if(barbeiro) params.set("barbeiro", barbeiro);
    if(dia) params.set("dia", dia);
    if(params.toString()) url += "?" + params.toString();

    const r = await fetch(url);
    const agend = await r.json();
    const totalAgend = agend.length;
    const clientesUnicos = new Set(agend.map(a => (a.nome||"").trim())).size;

    const rg = await fetch(`${API_URL}/ganhos`);
    const ganhosObj = await rg.json();
    let ganhosValor = 0;
    if(barbeiro) ganhosValor = Number(ganhosObj[barbeiro]||0);
    else ganhosValor = Object.values(ganhosObj).reduce((s,v)=>s+Number(v||0),0);

    cardGanhos.textContent = `R$ ${ganhosValor.toFixed(2)}`;
    cardClientes.textContent = clientesUnicos;
    cardAgendamentos.textContent = totalAgend;
  } catch(e){ console.error(e); }
}

// === EVENTOS ===
barbeiroSelect.addEventListener("change", ()=> {
  carregarAgendamentos(barbeiroSelect.value,dateSelect.value);
  atualizarCards(barbeiroSelect.value,dateSelect.value);
  carregarGanhosGerente();
});

dateSelect.addEventListener("change", ()=> {
  carregarAgendamentos(barbeiroSelect.value,dateSelect.value);
  atualizarCards(barbeiroSelect.value,dateSelect.value);
});

document.getElementById("clearFilters").addEventListener("click", ()=>{
  barbeiroSelect.value = "";
  dateSelect.value = "";
  carregarAgendamentos("","");  
  atualizarCards("","");
  carregarGanhosGerente();
});

// === INICIALIZA ===
carregarAgendamentos("",""); atualizarCards("",""); carregarGanhosGerente();
</script>
</body>
</html>
