<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel do Barbeiro</title>
<link rel="icon" type="image/png" href="favicon-removebg-preview.png" />
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
  body{background:#f4f6f9;min-height:100vh;display:flex;align-items:flex-start;padding:30px}

  /* layout painel */
  #painelContainer{width:100%;max-width:1400px;margin:0 auto;display:flex;gap:20px}
  .sidebar{width:240px;background:#2c2c54;color:#fff;border-radius:16px;padding:22px;flex-shrink:0;box-shadow:0 6px 16px rgba(0,0,0,0.15)}
  .sidebar h2{margin-bottom:28px;text-align:center;font-size:22px;color:#fff}
  .sidebar a{display:block;color:#ddd;text-decoration:none;padding:12px 14px;border-radius:10px;margin:8px 0;transition:.2s}
  .sidebar a:hover{background:#40407a;color:#fff}

  .main{flex:1}

  /* t√≠tulo */
  .main h1{margin-bottom:18px;font-size:26px;color:#2c2c54}

  /* cards */
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px;margin-bottom:22px}
  .card{background:#fff;padding:20px;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,0.07);text-align:center;transition:.2s}
  .card:hover{transform:translateY(-3px)}
  .card h3{font-size:15px;color:#777;margin-bottom:10px}
  .card p{font-size:22px;color:#2c2c54;font-weight:700}

  /* filtros e tabela */
  .filters{display:flex;gap:14px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
  .filters label{font-weight:600;color:#444}
  select,input[type="date"]{padding:10px 12px;border-radius:10px;border:1px solid #ddd;background:#fff}
  .filters button{padding:10px 14px;border-radius:10px;border:none;background:#ddd;cursor:pointer;font-weight:600}
  .filters button:hover{background:#ccc}

  table{width:100%;border-collapse:collapse;background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,0.07)}
  th,td{padding:14px;text-align:left}
  th{background:#2c2c54;color:#fff;font-size:14px}
  tr:nth-child(even){background:#fbfbfb}
  tr:hover{background:#f1f1f1}

  .no-appointments{margin:16px 0;color:#666;font-style:italic}

  /* painel gerente */
  #gerentePanel{margin-top:20px;display:none;background:#fff;padding:20px;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,0.07)}
  #ganhosBarbeiros{display:flex;gap:10px;flex-wrap:wrap;list-style:none;padding:0;margin-top:12px}
  #ganhosBarbeiros li{background:#2c2c54;color:#fff;padding:10px 14px;border-radius:8px;font-weight:600}
</style>
</head>
<body>

  <!-- PAINEL -->
  <div id="painelContainer">
    <aside class="sidebar">
      <h2>üíà Barber</h2>
      <a href="#">üìÖ Agenda</a>
      <a href="#">üìä Relat√≥rios</a>
      <a href="#">‚úâÔ∏è Mensagens</a>
      <a href="#">‚öôÔ∏è Configura√ß√µes</a>
    </aside>

    <div class="main">
      <h1>Painel do Barbeiro</h1>

      <div class="cards">
        <div class="card"><h3>Ganhos</h3><p id="cardGanhos">R$ 0,00</p></div>
        <div class="card"><h3>Clientes</h3><p id="cardClientes">0</p></div>
        <div class="card"><h3>Agendamentos</h3><p id="cardAgendamentos">0</p></div>
        <div class="card"><h3>Avalia√ß√£o</h3><p id="cardAvaliacao">‚≠ê 8,5</p></div>
      </div>

      <div class="filters">
        <label for="barbeiroSelect">Barbeiro:</label>
        <select id="barbeiroSelect">
          <option value="">-- Todos --</option>
          <option value="Lucas Dias">Lucas Dias</option>
          <option value="Isaias Barreto">Isaias Barreto</option>
          <option value="Isaias Santana">Isaias Santana</option>
        </select>

        <label for="dateSelect">Data:</label>
        <input type="date" id="dateSelect" />

        <button id="clearFilters">Limpar filtros</button>
      </div>

      <table id="agendaTable">
        <thead>
          <tr><th>Dia</th><th>Hor√°rio</th><th>Cliente</th><th>Servi√ßo</th><th>Barbeiro</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="noAppointments" class="no-appointments">Selecione um barbeiro ou uma data para ver os agendamentos.</div>

      <div id="gerentePanel">
        <h2>üìà Dashboard do Gerente</h2>
        <p>Aqui voc√™ ver√° vendas e desempenho dos barbeiros:</p>
        <ul id="ganhosBarbeiros"></ul>
      </div>
    </div>
  </div>

<script>
  // --- CONFIG ---
  const API_URL = "https://soulfade.onrender.com/api"; 

  const barbeiroSelect = document.getElementById("barbeiroSelect");
  const dateSelect = document.getElementById("dateSelect");
  const tableBody = document.querySelector("#agendaTable tbody");
  const noAppointments = document.getElementById("noAppointments");

  const gerentePanel = document.getElementById("gerentePanel");
  const ganhosBarbeirosList = document.getElementById("ganhosBarbeiros");

  // cards
  const cardGanhos = document.getElementById("cardGanhos");
  const cardClientes = document.getElementById("cardClientes");
  const cardAgendamentos = document.getElementById("cardAgendamentos");

  // --- FUN√á√ïES PRINCIPAIS ---
  async function carregarAgendamentos(barbeiro, dia) {
    try {
      let url = `${API_URL}/agendamentos`;
      const params = new URLSearchParams();
      if (barbeiro) params.set("barbeiro", barbeiro);
      if (dia) params.set("dia", dia);
      if (params.toString()) url += "?" + params.toString();

      const res = await fetch(url);
      if (!res.ok) throw new Error("Erro na API");
      const agendamentos = await res.json();

      tableBody.innerHTML = "";

      if (!agendamentos || agendamentos.length === 0) {
        noAppointments.textContent = "Nenhum agendamento encontrado.";
        noAppointments.style.display = "block";
        return;
      }

      noAppointments.style.display = "none";

      agendamentos.forEach(a => {
        const diaStr = (a.dia || "").split("T")[0];
        const diaFmt = diaStr ? new Date(diaStr).toLocaleDateString("pt-BR") : (a.dia || "");
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${diaFmt}</td>
          <td>${a.horario || ""}</td>
          <td>${a.nome || ""}</td>
          <td>${a.servico || ""}</td>
          <td>${a.barbeiro || ""}</td>
          <td>
            <button class="editBtn" data-id="${a.id}">Editar</button>
            <button class="delBtn" data-id="${a.id}">Excluir</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });

    } catch (err) {
      console.error(err);
      tableBody.innerHTML = "";
      noAppointments.textContent = "Erro ao carregar agendamentos.";
      noAppointments.style.display = "block";
    }
  }

  async function carregarGanhosGerente() {
    try {
      const res = await fetch(`${API_URL}/ganhos`);
      if (!res.ok) throw new Error("Erro ganhos");
      const ganhos = await res.json();
      ganhosBarbeirosList.innerHTML = "";
      for (let b in ganhos) {
        const li = document.createElement("li");
        li.textContent = `${b}: R$ ${Number(ganhos[b]).toFixed(2)}`;
        ganhosBarbeirosList.appendChild(li);
      }
      gerentePanel.style.display = "block";
    } catch (err) {
      console.error(err);
    }
  }

  async function atualizarCards(barbeiro, dia) {
    try {
      let url = `${API_URL}/agendamentos`;
      const params = new URLSearchParams();
      if (barbeiro) params.set("barbeiro", barbeiro);
      if (dia) params.set("dia", dia);
      if (params.toString()) url += "?" + params.toString();

      const r = await fetch(url);
      const agend = await r.json();

      const totalAgend = agend.length;
      const clientesUnicos = new Set(agend.map(a => (a.nome||"").trim())).size;

      const rg = await fetch(`${API_URL}/ganhos`);
      const ganhosObj = await rg.json();
      let ganhosValor = 0;
      if (barbeiro) ganhosValor = Number(ganhosObj[barbeiro] || 0);
      else ganhosValor = Object.values(ganhosObj).reduce((s, v) => s + Number(v || 0), 0);

      cardGanhos.textContent = `R$ ${ganhosValor.toFixed(2)}`;
      cardClientes.textContent = clientesUnicos;
      cardAgendamentos.textContent = totalAgend;

    } catch (err) {
      console.error("Erro atualizarCards:", err);
    }
  }

  // filtros
  barbeiroSelect.addEventListener("change", () => {
    carregarAgendamentos(barbeiroSelect.value, dateSelect.value);
    atualizarCards(barbeiroSelect.value, dateSelect.value);
    carregarGanhosGerente();
  });

  dateSelect.addEventListener("change", () => {
    carregarAgendamentos(barbeiroSelect.value, dateSelect.value);
    atualizarCards(barbeiroSelect.value, dateSelect.value);
  });

  document.getElementById("clearFilters").addEventListener("click", () => {
    barbeiroSelect.value = "";
    dateSelect.value = "";
    carregarAgendamentos("", "");
    atualizarCards("", "");
    carregarGanhosGerente();
  });

  // inicia painel direto
  carregarAgendamentos("", "");
  atualizarCards("", "");
  carregarGanhosGerente();
</script>
</body>
</html>
